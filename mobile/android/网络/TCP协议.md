# TCP协议
网络传输协议的一种，这里暂时只了解三次握手和四次挥手
## 三次握手
三次握手的过程：
1. 第一次握手：建立连接。客户端发送连接请求报文，将SYN设置为1、Sequence Number(seq)为x；接下来客户端进入SYN_SENT状态，等待服务端的确认
2. 第二次握手：服务器收到客户端进入SYN报文段，对SYN报文进行确认，设置Acknowledgment(ACK)为x+1(seq+1)；同时自己好要发送SYN请求信息，将SYN设置为1、seq为y。服务端将上述所有信息放到SYN+ACK报文段中，一并发送给客户端，此时服务端进入SYN_RCVD状态
3. 第三次握手：客户端收到服务端的SYN+ACK报文段；然后将ACK设置y+1,向服务端发送ACK报文段，这个报文段发送完毕后，客户端和服务端都进入ESTABLISHED(TCP连接成功)状态，完成TCP的三次握手


## 四次挥手
- 第一次挥手：客户端设置seq和ACK，向服务端发送一个FIN报文段。此时客户端进入FIN_WAIT_1状态，表示客户端没有数据要发送给客户端了
- 第二次挥手：服务端收到了客户端发送的FIN报文段，向客户端回了一个ACK报文段
- 第三次挥手：服务端想客户端发送FIN报文段，请求关闭连接，同时服务端进入LAST_ACK状态。
- 第四次挥手：客户端收到服务端发送的FIN报文段，向服务端发送ACK报文段，然后客户端进入TIME_WAIT状态。服务端收到客户端的ACK报文段以后，就关闭连接。此时，客户端等待2MSL(最大报文段生存时间)后依然没有收到回复，则说明服务端以正常关闭，这样客户端也可以关闭连接了


## Http协议的keepalive机制
如果有大量的连接，每次在连接、关闭时都要经历三次握手、四次挥手，这很显然会造成性能低下。因此，HTTP有一种叫做keepalive connections的机制，它可以在传输数据后仍然保持连接，当客户端需要再次获取数据时，直接使用刚刚空闲下来的连接而无须再次握手

打开连接 -> 写请求数据 -> 读相应数据 -> timeout -> 关闭连接

发生timeout后会重新写请求数据 ![image](http://note.youdao.com/yws/res/4956/WEBRESOURCE7633a30fa4292d8addd4b6466055d4af)